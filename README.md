# Databricks Genie æ©Ÿå™¨äºº

## ç›®æ¨™

æœ¬å°ˆæ¡ˆå¯¦ä½œäº†ä¸€å€‹å¯¦é©—æ€§èŠå¤©æ©Ÿå™¨äººï¼Œèˆ‡ Databricks çš„ Genie API äº’å‹•ï¼Œè©² API ç›®å‰è™•æ–¼ç§äººé è¦½éšŽæ®µä¸”æœªç²å¾—å®˜æ–¹æ”¯æ´ï¼ˆè‹¥æœ‰è®Šæ›´å°‡æœƒæ›´æ–°ï¼‰ã€‚æ­¤æ©Ÿå™¨äººæ—¨åœ¨é€éŽåƒ MS Teams é€™æ¨£çš„èŠå¤©ä»‹é¢ï¼Œä¿ƒé€²èˆ‡ Databricks çš„ AI åŠ©ç† Genie çš„å°è©±ã€‚

## æ¦‚è¿°

æ­¤å¯¦é©—æ€§ç¨‹å¼ç¢¼ä½¿ç”¨ Genie API åœ¨ Databricks ä¸­å»ºç«‹äº†ä¸€å€‹ Genie æ©Ÿå™¨äººã€‚è«‹æ³¨æ„ï¼Œé€™ä¸æ˜¯ç”Ÿç”¢å°±ç·’çš„ç¨‹å¼ç¢¼ï¼Œä¹Ÿä¸èˆ‡ä»»ä½•é›‡ä¸»ç›¸é—œè¯æˆ–ç²å¾—å…¶èªå¯ã€‚æ­¤ç¨‹å¼ç¢¼åƒ…ä¾›å¯¦é©—å’Œå­¸ç¿’ç›®çš„æŒ‰åŽŸæ¨£ä½¿ç”¨ã€‚

## ä¸»è¦åŠŸèƒ½

- èˆ‡ Databricks çš„ Genie API æ•´åˆï¼Œä»¥é–‹å§‹å°è©±ä¸¦è™•ç†å¾ŒçºŒè¨Šæ¯
- è™•ç†ä½¿ç”¨è€…æŸ¥è©¢ä¸¦å‘ˆç¾ Genie çš„å›žæ‡‰
- ç®¡ç†å¤šå€‹ä½¿ç”¨è€…çš„å°è©±ç‹€æ…‹
- å°‡æŸ¥è©¢çµæžœæ ¼å¼åŒ–ä¸¦é¡¯ç¤ºç‚ºå¯è®€çš„ Markdown è¡¨æ ¼
- è™•ç†ä¾†è‡ª Genie çš„æ¾„æ¸…è«‹æ±‚
- **æ–°åŠŸèƒ½**ï¼šæ•´åˆè®š/å€’è®šå›žé¥‹ç³»çµ±ï¼Œå°‡å›žé¥‹ç›´æŽ¥ç™¼é€åˆ° Databricks Genie API
- å…·æœ‰é©ç•¶éŒ¯èª¤è™•ç†å’Œä½¿ç”¨è€…é€šçŸ¥çš„å³æ™‚å›žé¥‹æ”¶é›†
- **ðŸŽ¨ åœ–è¡¨è¦–è¦ºåŒ–**ï¼šè‡ªå‹•ç”Ÿæˆåœ–è¡¨åœ–ç‰‡ï¼ˆé•·æ¢åœ–ã€åœ“é¤…åœ–ã€æŠ˜ç·šåœ–ï¼‰ä¸¦é¡¯ç¤ºåœ¨ Teams ä¸­
  - æ™ºèƒ½åˆ¤æ–·æ•¸æ“šé¡žåž‹ä¸¦é¸æ“‡æœ€é©åˆçš„åœ–è¡¨
  - ä½¿ç”¨ Plotly ç”Ÿæˆç¾ä»£åŒ–ã€ç¾Žè§€çš„åœ–è¡¨åœ–ç‰‡
  - æ”¯æŒä¸­æ–‡æ¨™ç±¤å’Œæ¨™é¡Œ
  - é€šéŽ Adaptive Card ç„¡ç¸«é¡¯ç¤º
  - è©³ç´°èªªæ˜Žè«‹åƒé–± [CHART_FEATURE_GUIDE.md](CHART_FEATURE_GUIDE.md)

### ðŸ“– æž¶æ§‹å„ªåŒ–å’Œæœ€ä½³å¯¦è¸

æœ¬é …ç›®å·²é€²è¡Œå…¨é¢çš„æž¶æ§‹åˆ†æžï¼Œè­˜åˆ¥äº† 10 å€‹æ”¹å–„é ˜åŸŸã€‚è«‹åƒé–±ä»¥ä¸‹æŒ‡å—ï¼š

### ðŸš€ å¿«é€Ÿé–‹å§‹ (ç«‹å³æ”¹å–„)

- **[docs/architecture/optimization.md](docs/architecture/optimization.md)** - å®Œæ•´æ€§èƒ½å„ªåŒ–æŒ‡å—ï¼ˆå¯¦æ–½ç‹€æ…‹ã€å¿«é€Ÿé–‹å§‹ã€è©³ç´°å»ºè­°ï¼‰
- **[docs/troubleshooting.md](docs/troubleshooting.md)** - å®Œæ•´æ•…éšœæŽ’æŸ¥æŒ‡å—ï¼ˆæ‰€æœ‰å¸¸è¦‹å•é¡Œå’Œè§£æ±ºæ–¹æ¡ˆï¼‰

#### ç«‹å³æ”¹å–„çš„ 3 å¤§æ ¸å¿ƒå•é¡Œ

1. **å…§å­˜æ´©æ¼é¢¨éšª** â­â­â­â­â­ - æœƒè©±ç„¡è‡ªå‹•æ¸…ç† (24h å¾Œ OOM)
2. **ç„¡ç›£æŽ§å’Œå¯è§€æ¸¬æ€§** â­â­â­â­â­ - ç„¡æ³•è¨ºæ–·æ€§èƒ½å•é¡Œ
3. **æ²’æœ‰ API å®¹éŒ¯æ©Ÿåˆ¶** â­â­â­â­â­ - å¶ç™¼æ•…éšœå°Žè‡´æŸ¥è©¢å¤±æ•—

**é æœŸæ”¶ç›Š**: 2-3 å°æ™‚å·¥ä½œå¯å¯¦ç¾ â†’ 99.9% å¯ç”¨æ€§ + 99.5% æˆåŠŸçŽ‡ + å®Œå…¨å¯è¦–åŒ–

---

## ðŸ“– æž¶æ§‹å„ªåŒ–å’Œæœ€ä½³å¯¦è¸

æœ¬é …ç›®å·²é€²è¡Œå…¨é¢çš„æž¶æ§‹åˆ†æžï¼Œè­˜åˆ¥äº† 10 å€‹æ”¹å–„é ˜åŸŸã€‚è«‹åƒé–±ä»¥ä¸‹æŒ‡å—ï¼š

### ðŸš€ å¿«é€Ÿé–‹å§‹ (ç«‹å³æ”¹å–„)

- **[docs/architecture/optimization.md](docs/architecture/optimization.md)** - 3 å¤§æ ¸å¿ƒæ”¹å–„æ¦‚è¿°å’Œè¡Œå‹•è¨ˆåŠƒ

#### ç«‹å³æ”¹å–„çš„ 3 å¤§æ ¸å¿ƒå•é¡Œ

1. **å…§å­˜æ´©æ¼é¢¨éšª** â­â­â­â­â­ - æœƒè©±ç„¡è‡ªå‹•æ¸…ç† (24h å¾Œ OOM)
2. **ç„¡ç›£æŽ§å’Œå¯è§€æ¸¬æ€§** â­â­â­â­â­ - ç„¡æ³•è¨ºæ–·æ€§èƒ½å•é¡Œ
3. **æ²’æœ‰ API å®¹éŒ¯æ©Ÿåˆ¶** â­â­â­â­â­ - å¶ç™¼æ•…éšœå°Žè‡´æŸ¥è©¢å¤±æ•—

**é æœŸæ”¶ç›Š**: 2-3 å°æ™‚å·¥ä½œå¯å¯¦ç¾ â†’ 99.9% å¯ç”¨æ€§ + 99.5% æˆåŠŸçŽ‡ + å®Œå…¨å¯è¦–åŒ–

---

## å¯¦ä½œç´°ç¯€

æ©Ÿå™¨äººä½¿ç”¨ä»¥ä¸‹æŠ€è¡“å»ºæ§‹ï¼š

- Python
- Bot Framework SDK
- ç”¨æ–¼éžåŒæ­¥ HTTP è«‹æ±‚çš„ aiohttp
- Databricks Genie APIï¼ˆå…¬é–‹é è¦½ç‰ˆï¼‰

ç³»çµ±çš„ä¸»è¦çµ„ä»¶åŒ…æ‹¬ï¼š

- `ask_genie` å‡½æ•¸ï¼Œè™•ç†èˆ‡ Genie API çš„é€šè¨Š
- `MyBot` é¡žåˆ¥ï¼Œè™•ç†å‚³å…¥è¨Šæ¯ä¸¦ç®¡ç†ä½¿ç”¨è€…å°è©±
- ä¸€å€‹ aiohttp Web æ‡‰ç”¨ç¨‹å¼ï¼Œä½œç‚ºæ©Ÿå™¨äººè¨Šæ¯çš„é€²å…¥é»ž
- **æ–°åŠŸèƒ½**ï¼šæ•´åˆå›žé¥‹ç³»çµ±ï¼Œä½¿ç”¨ç™¼é€è¨Šæ¯å›žé¥‹ç«¯é»žå°‡ä½¿ç”¨è€…å›žé¥‹ç›´æŽ¥ç™¼é€åˆ° Databricks Genie API

## å·¥ä½œéšŽæ®µç®¡ç†æž¶æ§‹

### é©—è­‰å¦‚ä½•é‹ä½œ

æ©Ÿå™¨äººä½¿ç”¨ **å–®ä¸€ Databricks æ¬Šæ–**ï¼ˆé€éŽ `DATABRICKS_TOKEN` è¨­å®šï¼‰ä¾†é©—è­‰å° Databricks Genie API çš„æ‰€æœ‰è«‹æ±‚ã€‚é€™æ˜¯æ©Ÿå™¨äººä»£è¡¨æ‰€æœ‰ä½¿ç”¨è€…ä½¿ç”¨çš„å…±äº«æ†‘è­‰ã€‚

### ä½¿ç”¨è€…å·¥ä½œéšŽæ®µå¦‚ä½•ç®¡ç†

é›–ç„¶ä½¿ç”¨å–®ä¸€æ¬Šæ–é€²è¡Œ API é©—è­‰ï¼Œä½†æ©Ÿå™¨äººç‚ºæ¯å€‹ä½¿ç”¨è€…ç¶­è­· **ç¨ç«‹çš„å·¥ä½œéšŽæ®µä¸Šä¸‹æ–‡**ï¼š

1. **ä½¿ç”¨è€…è­˜åˆ¥**ï¼šæ¯å€‹ä½¿ç”¨è€…ç”±å…¶é›»å­éƒµä»¶åœ°å€è­˜åˆ¥ï¼ˆæ‰‹å‹•æä¾›æˆ–ä¾†è‡ª Teams è¨­å®šæª”ï¼‰
2. **å·¥ä½œéšŽæ®µéš”é›¢**ï¼šæ¯å€‹ä½¿ç”¨è€…ç²å¾—è‡ªå·±çš„ `UserSession` ç‰©ä»¶ï¼Œè©²ç‰©ä»¶è¿½è¹¤ï¼š
   - ä½¿ç”¨è€…é›»å­éƒµä»¶å’Œåç¨±
   - èˆ‡ Genie çš„å€‹åˆ¥å°è©± ID
   - å°è©±æ­·å²å’Œä¸Šä¸‹æ–‡
   - æœ€å¾Œæ´»å‹•æ™‚é–“æˆ³è¨˜
   - ä½¿ç”¨è€…ç‰¹å®šåå¥½

3. **å°è©±ä¸Šä¸‹æ–‡**ï¼šæ©Ÿå™¨äººç‚ºæ¯å€‹ä½¿ç”¨è€…ç¶­è­·ç¨ç«‹çš„ Genie å°è©±åŸ·è¡Œç·’ï¼Œç¢ºä¿ï¼š
   - ä½¿ç”¨è€… A çš„å•é¡Œä¸æœƒå½±éŸ¿ä½¿ç”¨è€… B çš„å°è©±
   - æ¯å€‹ä½¿ç”¨è€…éƒ½å¯ä»¥åœ¨è‡ªå·±çš„ä¸Šä¸‹æ–‡ä¸­æå‡ºå¾ŒçºŒå•é¡Œ
   - å°è©±åœ¨é–’ç½® 4 å°æ™‚å¾Œè‡ªå‹•é‡ç½®å‰æœƒè¢«ä¿ç•™

4. **æŸ¥è©¢è¨˜éŒ„**ï¼šç•¶æŸ¥è©¢ç™¼é€åˆ° Genie æ™‚ï¼Œä½¿ç”¨è€…çš„é›»å­éƒµä»¶æœƒé™„åŠ åˆ°å•é¡Œå‰é¢ï¼Œä»¥ä¾¿åœ¨ Databricks ä¸­é€²è¡Œè¿½è¹¤ï¼š

   ```text
   [user@company.com] ä»€éº¼æ˜¯æœ€æš¢éŠ·çš„ç”¢å“ï¼Ÿ
   ```

### æ­¤æž¶æ§‹çš„å„ªé»ž

- **ç°¡åŒ–ç®¡ç†**ï¼šç®¡ç†å–®ä¸€æ¬Šæ–è€Œä¸æ˜¯æ¯å€‹ä½¿ç”¨è€…çš„æ†‘è­‰
- **ä½¿ç”¨è€…éš±ç§**ï¼šæ¯å€‹ä½¿ç”¨è€…çš„å°è©±èˆ‡å…¶ä»–äººéš”é›¢
- **ä¸Šä¸‹æ–‡ä¿ç•™**ï¼šä½¿ç”¨è€…å¯ä»¥èˆ‡ Genie é€²è¡Œè‡ªç„¶çš„å¤šè¼ªå°è©±
- **ç¨½æ ¸è¿½è¹¤**ï¼šæ‰€æœ‰æŸ¥è©¢éƒ½åœ¨ Databricks ä¸­è¨˜éŒ„ä¸¦æ­¸å±¬çµ¦ä½¿ç”¨è€…
- **å¯æ“´å±•æ€§**ï¼šåªéœ€æœ€å°‘çš„è¨­å®šå³å¯æ”¯æ´è¨±å¤šä¸¦ç™¼ä½¿ç”¨è€…

### å®‰å…¨è€ƒé‡

- Databricks æ¬Šæ–æ‡‰å…·æœ‰å­˜å– Genie Space çš„é©ç•¶æ¬Šé™
- ä½¿ç”¨è€…é›»å­éƒµä»¶åƒ…ç”¨æ–¼è¨˜éŒ„ï¼Œä¸ç”¨æ–¼é©—è­‰
- å·¥ä½œéšŽæ®µå„²å­˜åœ¨è¨˜æ†¶é«”ä¸­ï¼Œä¸¦åœ¨é–’ç½® 4 å°æ™‚å¾Œæ¸…é™¤
- åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­ï¼Œè€ƒæ…®ä½¿ç”¨ Azure Key Vault å„²å­˜ Databricks æ¬Šæ–

### å…¶ä»–é©—è­‰é¸é …

- é›–ç„¶æ­¤æ©Ÿå™¨äººä½¿ç”¨å–®ä¸€æ¬Šæ–ä¾†ç®¡ç†è¨±å¤šä½¿ç”¨è€…ï¼Œä½†å¦‚æžœæ‚¨é¸æ“‡ï¼Œæ‚¨å¯ä»¥é€éŽ OAuth é€£æŽ¥ Databricks å’Œ Teamsã€‚é€™åªæ˜¯æˆ‘å€‘å»ºç«‹çš„ç¯„ä¾‹

## å…è²¬è²æ˜Ž

æ­¤ç¨‹å¼ç¢¼æ˜¯å¯¦é©—æ€§çš„ï¼Œä½¿ç”¨å°šæœªç”± Databricks æ”¯æ´çš„å…¬é–‹é è¦½ APIã€‚å®ƒä¸æ‡‰åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­ä½¿ç”¨ï¼Œåƒ…ä¾›æ•™è‚²å’Œå¯¦é©—ç›®çš„ä½¿ç”¨ã€‚ä½¿ç”¨é¢¨éšªè‡ªè² ã€‚

ç¨‹å¼ç¢¼å·²åœ¨ Azure Bot Framework ä¸­æ¸¬è©¦ï¼Œè©²æ¡†æž¶æœ‰åŠ©æ–¼èˆ‡ä»»ä½•èŠå¤©æ©Ÿå™¨äººï¼ˆå¦‚ MS Teamsï¼‰æ•´åˆã€‚

## è¨­å®šå’Œä½¿ç”¨

### ðŸš€ å¿«é€Ÿé–‹å§‹ (5 åˆ†é˜)

è©³è¦‹ [docs/setup/quick_start.md](docs/setup/quick_start.md) - åŒ…å«å®Œæ•´å®‰è£æ­¥é©Ÿå’Œå¸¸è¦‹å•é¡Œä¿®å¾©

### åŸºæœ¬æ­¥é©Ÿ

### åŸºæœ¬æ­¥é©Ÿ

0. Python ç‰ˆæœ¬ 3.11+
1. å®‰è£ `uv` (æŽ¨è–¦) ä¸¦åŸ·è¡Œ `uv sync` å®‰è£ä¾è³´
2. è¨­å®šå¿…è¦çš„ç’°å¢ƒè®Šæ•¸ï¼ˆè«‹åƒé–±ä¸‹é¢çš„ç’°å¢ƒè®Šæ•¸éƒ¨åˆ†ï¼‰
3. åŸ·è¡Œ `uv run fastapi dev app/main.py` ä»¥å•Ÿå‹•æ©Ÿå™¨äºº
4. é€éŽ Azure Bot Framework å‘¼å«æ©Ÿå™¨äººç«¯é»ž (port 8000)

### ðŸ” ç’°å¢ƒè¨ºæ–·

```bash
# è‡ªå‹•æª¢æŸ¥å’Œä¿®å¾©å¸¸è¦‹å•é¡Œ
python scripts/diagnose.py
```

## ç’°å¢ƒè®Šæ•¸

æ‡‰ç”¨ç¨‹å¼ä½¿ç”¨ç’°å¢ƒè®Šæ•¸é€²è¡Œè¨­å®šã€‚æ‚¨å¯ä»¥åœ¨éƒ¨ç½²ç’°å¢ƒï¼ˆGitHub Actionsã€Azure ç­‰ï¼‰ä¸­è¨­å®šé€™äº›è®Šæ•¸ï¼Œæˆ–ç‚ºæœ¬åœ°é–‹ç™¼å»ºç«‹ `.env` æª”æ¡ˆã€‚

å°‡ `env.example` è¤‡è£½åˆ° `.env` ä¸¦å¡«å…¥æ‚¨çš„å€¼ï¼š

```bash
cp env.example .env
```

### å¿…è¦ç’°å¢ƒè®Šæ•¸

- `DATABRICKS_TOKEN`: æ‚¨çš„ Databricks å€‹äººå­˜å–æ¬Šæ–ï¼ˆå¿…è¦ï¼‰

### ç”Ÿç”¢ç’°å¢ƒè®Šæ•¸

- `APP_ID`: æ‚¨çš„ Azure Bot Service æ‡‰ç”¨ç¨‹å¼ ID
- `APP_PASSWORD`: æ‚¨çš„ Azure Bot Service æ‡‰ç”¨ç¨‹å¼å¯†ç¢¼
- `APP_TENANTID`: æ‚¨çš„ Azure ç§Ÿæˆ¶ ID

### é¸ç”¨ç’°å¢ƒè®Šæ•¸

- `PORT`: æ‡‰ç”¨ç¨‹å¼çš„é€£æŽ¥åŸ è™Ÿç¢¼ï¼ˆé è¨­ï¼š3978ï¼‰
- `APP_TYPE`: æ©Ÿå™¨äººé¡žåž‹ - "SingleTenant" æˆ– "MultiTenant"ï¼ˆé è¨­ï¼š"SingleTenant"ï¼‰
- `DATABRICKS_SPACE_ID`: Genie å°è©±å°‡ç™¼ç”Ÿçš„ Databricks Space IDï¼ˆæœ‰é è¨­å€¼ï¼‰
- `DATABRICKS_HOST`: æ‚¨çš„ Databricks å·¥ä½œå€ URLï¼ˆæœ‰é è¨­å€¼ï¼‰
- `SAMPLE_QUESTIONS`: ä»¥åˆ†è™Ÿåˆ†éš”çš„ç¯„ä¾‹å•é¡Œåˆ—è¡¨ï¼Œåœ¨ä½¿ç”¨è€…é¦–æ¬¡ç™»å…¥æ™‚é¡¯ç¤ºã€‚æ ¹æ“šæ‚¨çš„ç‰¹å®š Genie ç©ºé–“å’Œä½¿ç”¨æ¡ˆä¾‹è‡ªè¨‚é€™äº›å•é¡Œï¼ˆé è¨­ï¼šé—œæ–¼è³‡æ–™å¯ç”¨æ€§çš„é€šç”¨å•é¡Œï¼‰
- `ADMIN_CONTACT_EMAIL`: åœ¨ info æŒ‡ä»¤ä¸­é¡¯ç¤ºçµ¦ä½¿ç”¨è€…ä»¥é€²è¡Œæ”¯æ´æŸ¥è©¢çš„é›»å­éƒµä»¶åœ°å€ï¼ˆé è¨­ï¼š`admin@company.com`ï¼‰
- `ENABLE_FEEDBACK_CARDS`: å•Ÿç”¨/åœç”¨å›žé¥‹æ”¶é›†ï¼ˆé è¨­ï¼šTrueï¼‰
- `ENABLE_GENIE_FEEDBACK_API`: å•Ÿç”¨/åœç”¨ç™¼é€å›žé¥‹åˆ° Databricks Genie APIï¼ˆé è¨­ï¼šTrueï¼‰

### Microsoft Graph API è¨­å®šï¼ˆæ–°åŠŸèƒ½ï¼‰

æ©Ÿå™¨äººç¾åœ¨æ”¯æ´é€éŽ Microsoft Graph API è‡ªå‹•å–å¾—ä½¿ç”¨è€…è³‡è¨Šï¼ŒåŒ…æ‹¬ email å’Œ OpenID (Azure AD Object ID)ï¼š

- `ENABLE_GRAPH_API_AUTO_LOGIN`: å•Ÿç”¨/åœç”¨è‡ªå‹•å¾ž Graph API å–å¾—ä½¿ç”¨è€…è³‡è¨Šï¼ˆé è¨­ï¼šFalseï¼‰
- `OAUTH_CONNECTION_NAME`: Azure Portal ä¸­è¨­å®šçš„ OAuth Connection åç¨±ï¼ˆé è¨­ï¼šç©ºï¼‰

**å¦‚ä½•è¨­å®š Graph APIï¼š**

2. è«‹åƒé–± `docs/troubleshooting.md` ç²å–æ›´å¤šè³‡è¨Š
3. åœ¨ Azure Portal çš„ Bot Channels Registration ä¸­è¨­å®š OAuth Connection
4. è¨­å®šå¿…è¦çš„ API æ¬Šé™ï¼š`openid`, `email`, `profile`, `User.Read`
5. è¨­å®šç’°å¢ƒè®Šæ•¸ `ENABLE_GRAPH_API_AUTO_LOGIN=True`

**å„ªé»žï¼š**

- âœ… è‡ªå‹•å–å¾—ä½¿ç”¨è€… emailï¼ˆç„¡éœ€æ‰‹å‹•è¼¸å…¥ï¼‰
- âœ… å–å¾— Azure AD Object ID (OpenID)
- âœ… å–å¾—å®Œæ•´çš„ä½¿ç”¨è€…å€‹äººè³‡æ–™ï¼ˆDisplay Nameã€UPN ç­‰ï¼‰
- âœ… æ›´å¥½çš„ä½¿ç”¨è€…é«”é©—

è©³ç´°è¨­å®šæ­¥é©Ÿè«‹åƒé–± [docs/troubleshooting.md](docs/troubleshooting.md)

è«‹åƒé–±ç¨‹å¼ç¢¼è¨»è§£ä»¥ç²å–æœ‰é—œæ¯å€‹çµ„ä»¶åŠŸèƒ½çš„æ›´è©³ç´°è³‡è¨Šã€‚

## å›žé¥‹ç³»çµ±

æ©Ÿå™¨äººç¾åœ¨åŒ…å«ä¸€å€‹æ•´åˆçš„å›žé¥‹ç³»çµ±ï¼Œå…è¨±ä½¿ç”¨è€…å° Genie å›žæ‡‰æä¾›è®š/å€’è®šå›žé¥‹ã€‚æ­¤å›žé¥‹ä½¿ç”¨ç™¼é€è¨Šæ¯å›žé¥‹ç«¯é»žç›´æŽ¥ç™¼é€åˆ° Databricks Genie APIã€‚

### é‹ä½œæ–¹å¼

1. **è‡ªå‹•å›žé¥‹å¡**ï¼šåœ¨æ¯å€‹ Genie å›žæ‡‰å¾Œï¼Œä½¿ç”¨è€…æœƒçœ‹åˆ°å¸¶æœ‰è®š (ðŸ‘) å’Œå€’è®š (ðŸ‘Ž) æŒ‰éˆ•çš„å›žé¥‹å¡
2. **å³æ™‚æäº¤**ï¼šç•¶ä½¿ç”¨è€…é»žæ“Šå›žé¥‹æŒ‰éˆ•æ™‚ï¼Œå›žé¥‹æœƒç«‹å³ç™¼é€åˆ° Databricks Genie API
3. **éŒ¯èª¤è™•ç†**ï¼šå¦‚æžœ API å‘¼å«å¤±æ•—ï¼Œä½¿ç”¨è€…æœƒçœ‹åˆ°éŒ¯èª¤è¨Šæ¯ä¸¦å¯ä»¥é‡è©¦
4. **è¨­å®š**ï¼šå›žé¥‹ç³»çµ±å¯ä»¥é€éŽç’°å¢ƒè®Šæ•¸å•Ÿç”¨/åœç”¨

### ç™¼é€åˆ° Genie API çš„å›žé¥‹è³‡æ–™

- **è¨Šæ¯ ID**ï¼šå°è©±ä¸­çš„å¯¦éš› Genie è¨Šæ¯ ID
- **å°è©± ID**ï¼šGenie å°è©± ID
- **å›žé¥‹é¡žåž‹**ï¼š`POSITIVE` æˆ– `NEGATIVE`
- **ç©ºé–“ ID**ï¼šç™¼ç”Ÿå°è©±çš„ Databricks Space ID

**API è«‹æ±‚æ ¼å¼ï¼š**

```json
{
  "rating": "POSITIVE"
}
```

æˆ–

```json
{
  "rating": "NEGATIVE"
}
```

### è¨­å®šé¸é …

- `ENABLE_FEEDBACK_CARDS`: æŽ§åˆ¶æ˜¯å¦å‘ä½¿ç”¨è€…é¡¯ç¤ºå›žé¥‹å¡
- `ENABLE_GENIE_FEEDBACK_API`: æŽ§åˆ¶æ˜¯å¦å°‡å›žé¥‹ç™¼é€åˆ° Genie API
- å…©å€‹é¸é …é è¨­ç‚º `True` ä»¥ç²å¾—å®Œæ•´åŠŸèƒ½

## è‡ªè¨‚ç¯„ä¾‹å•é¡Œ

ç•¶ä½¿ç”¨è€…é¦–æ¬¡ç™»å…¥æ™‚ï¼Œæ©Ÿå™¨äººæœƒå‘ä»–å€‘é¡¯ç¤ºå¯ä»¥è©¢å•æœ‰é—œå…¶è³‡æ–™çš„ç¯„ä¾‹å•é¡Œã€‚æ‚¨å¯ä»¥è‡ªè¨‚é€™äº›å•é¡Œä»¥ç¬¦åˆæ‚¨çš„ç‰¹å®š Genie ç©ºé–“å’Œä½¿ç”¨æ¡ˆä¾‹ã€‚

### å¦‚ä½•è‡ªè¨‚

1. **é€éŽç’°å¢ƒè®Šæ•¸**ï¼šè¨­å®š `SAMPLE_QUESTIONS` ç’°å¢ƒè®Šæ•¸ï¼Œä½¿ç”¨åˆ†è™Ÿåˆ†éš”å•é¡Œï¼š

   ```bash
   SAMPLE_QUESTIONS=æœ¬æœˆæœ€æš¢éŠ·çš„ç”¢å“æ˜¯ä»€éº¼ï¼Ÿ;é¡¯ç¤ºå®¢æˆ¶æµå¤±çŽ‡;æˆ‘å€‘çš„æ”¶å…¥è¶¨å‹¢å¦‚ä½•ï¼Ÿ
   ```

2. **é€éŽ .env æª”æ¡ˆ**ï¼šåœ¨æ‚¨çš„ `.env` æª”æ¡ˆä¸­æ–°å¢žæˆ–æ›´æ–°è©²è¡Œï¼š

   ```bash
   SAMPLE_QUESTIONS=æœ¬æœˆæœ€æš¢éŠ·çš„ç”¢å“æ˜¯ä»€éº¼ï¼Ÿ;é¡¯ç¤ºå®¢æˆ¶æµå¤±çŽ‡;æˆ‘å€‘çš„æ”¶å…¥è¶¨å‹¢å¦‚ä½•ï¼Ÿ
   ```

3. **åœ¨ config.py ä¸­**ï¼šå¦‚æžœæœªè¨­å®šç’°å¢ƒè®Šæ•¸ï¼Œé è¨­å•é¡Œå®šç¾©åœ¨ `config.py` ä¸­

### ç¯„ä¾‹

**å°æ–¼éŠ·å”®è³‡æ–™ï¼š**

```bash
SAMPLE_QUESTIONS=æœ¬æœˆæœ€æš¢éŠ·çš„ç”¢å“æ˜¯ä»€éº¼ï¼Ÿ;æŒ‰åœ°å€é¡¯ç¤ºæ”¶å…¥;èª°æ˜¯æˆ‘å€‘æ”¶å…¥æœ€é«˜çš„å®¢æˆ¶ï¼Ÿ
```

**å°æ–¼æ”¯æ´å·¥å–®ï¼š**

```bash
SAMPLE_QUESTIONS=å·¥å–®çš„ä¸åŒç‹€æ…‹åŠå…¶è¨ˆæ•¸æ˜¯ä»€éº¼ï¼Ÿ;èª°æ˜¯æˆ‘è¡¨ç¾æœ€å¥½çš„ä»£ç†äººï¼Ÿ;å¹³å‡è§£æ±ºæ™‚é–“æ˜¯å¤šå°‘ï¼Ÿ
```

**å°æ–¼ IoT/æ„Ÿæ¸¬å™¨è³‡æ–™ï¼š**

```bash
SAMPLE_QUESTIONS=é¡¯ç¤ºéŽåŽ» 24 å°æ™‚çš„æº«åº¦è¶¨å‹¢;å“ªäº›æ„Ÿæ¸¬å™¨å ±å‘Šç•°å¸¸ï¼Ÿ;æŒ‰è¨­å‚™é¡žåž‹çš„å¹³å‡æ­£å¸¸é‹è¡Œæ™‚é–“æ˜¯å¤šå°‘ï¼Ÿ
```

**å°æ–¼ä¸€ç´šæ–¹ç¨‹å¼/é«”è‚²è³‡æ–™ï¼š**

```bash
SAMPLE_QUESTIONS=ä»Šå¹´çš„è»ŠéšŠæŽ’åå¦‚ä½•ï¼Ÿ;å“ªä½è»Šæ‰‹ç²å‹æ¬¡æ•¸æœ€å¤šï¼Ÿ;é¡¯ç¤ºéŽåŽ» 10 å ´æ¯”è³½çš„æŽ’ä½è³½ä½ç½®
```

æ©Ÿå™¨äººå°‡åœ¨ä½¿ç”¨è€…é¦–æ¬¡ç™»å…¥æ™‚å‘ä»–å€‘é¡¯ç¤ºé€™äº›å•é¡Œï¼Œä½¿ä»–å€‘èƒ½å¤ è¼•é¬†é–‹å§‹é€²è¡Œç›¸é—œæŸ¥è©¢ã€‚

## èˆ‡ MS Teams æ•´åˆ

```mermaid
sequenceDiagram
    participant User
    participant Azure Portal
    participant GitHub
    participant Azure CLI
    participant VSCode
    participant Web App
    participant Bot Service
    participant Databricks
    participant Teams

    User->>GitHub: Clone DatabricksGenieBOT repository
    User->>Azure Portal: Create App Service Plan (Linux)
    User->>Azure Portal: Create Web App (Python 3.12)
    User->>Azure Portal: Create Azure Bot AI Service
    User->>Azure Portal: Configure Bot (Secret, Icon, Description)
    User->>Azure Portal: Configure Bot Messaging Endpoint
    User->>Azure Portal: Configure Bot Channel (Teams)
    User->>Databricks: Curate Genie Space and get Space ID
    User->>Databricks: Generate Token
    User->>Azure Portal: Configure Web App (Startup Command, Environment Variables)
    User->>VSCode: Open project folder
    User->>Azure CLI: Install Azure CLI
    User->>VSCode: Create and activate virtual environment
    User->>VSCode: Install requirements
    User->>Azure CLI: Login (az login)
    User->>Azure CLI: Deploy Web App (az webapp up)
    User->>Azure Portal: Configure Web App settings
    User->>Azure Portal: Test Bot in Web Chat
    User->>Teams: Test Bot in Microsoft Teams
```
