---
name: project-guidelines
description: Core project guidelines and coding standards. Use when generating code, comments, documentation, or bot responses to ensure consistency.
---

# Project Guidelines & Standards

These guidelines must be followed for all changes in this project.

## 1. Language Requirement

**Strictly enforce Traditional Chinese (繁體中文)** for all human-readable text.

### Artifacts & Planning

- **Rule**: All implementation plans, walkthroughs, and reasoning artifacts generated by the agent must be in Traditional Chinese.

### code Comments

- **Rule**: All code comments must be in Traditional Chinese.
- **Example**:

  ```python
  # ✅ 正確：計算總收入
  total_revenue = calculate_total()

  # ❌ 錯誤：Calculate total revenue
  ```

### Documentation

- **Rule**: `README.md`, `*.md` files, and docstrings must be in Traditional Chinese.
- **Exception**: Specific technical terms where the English term is more standard in the industry (e.g., "OAuth", "Token", "DataFrame").

### Bot Responses

- **Rule**: All text sent to users (Activity text, Adaptive Cards, Error messages) must be in Traditional Chinese (Taiwan locale).
- **Tone**: Professional, helpful, and polite.

### Git Commit Messages

- **Rule**: All git commit messages must be in **Traditional Chinese (繁體中文)**.
- **Format**: `type: description` (e.g., `feat: 新增登入功能`, `fix: 修復 Teams 連線問題`).
- **Types**: `feat`, `fix`, `docs`, `style`, `refactor`, `test`, `chore`.

## 2. Coding Standards

### Python

- Follow PEP 8 style guide.
- Use type hinting (`typing` module) for function signatures.
- Use `logger` instead of `print` for output.

### Error Handling

- Do not expose raw stack traces to users.
- Log full errors to the console/Application Insights.
- Return user-friendly error messages in Traditional Chinese.

## 3. Environment Variables

- Never hardcode secrets.
- Always use `os.environ` or `os.getenv`.
- Document new variables in `.env.example`.

## 4. Advanced Coding Standards

### Async/Await (Non-blocking I/O)

- **Rule**: All I/O operations (API calls, DB queries) must be asynchronous.
- **Prohibited**: `time.sleep()`, synchronous `requests` library.
- **Required**: `asyncio.sleep()`, `aiohttp`.

### Docstrings (文件字串)

- **Rule**: All functions and classes must have docstrings in **Traditional Chinese**.
- **Style**: Google Style or NumPy Style.
- **Content**: Description, Args, Returns, Raises.

  ```python
  def fetch_data(user_id: str) -> dict:
      """
      從 Genie API 獲取用戶數據。

      Args:
          user_id (str): 用戶的唯一標識符。

      Returns:
          dict: 包含用戶數據的字典。

      Raises:
          ValueError: 如果 user_id 無效。
      """
  ```

### Import Sorting

- **Order**: Standard Library -> Third Party -> Local Application.
- **Example**:

  ```python
  import os
  import json

  import aiohttp
  from botbuilder.core import TurnContext

  from config import DefaultConfig
  ```

### Testing

- **Unit Tests**: Required for business logic.
- **Mocking**: External services (Genie API, Graph API) must be mocked. Never make real network calls in unit tests.

## 5. Recommended Directory Structure

To support a scalable FastAPI + Bot Framework architecture, use the following structure:

```text
.
├── .antigravity/        # Agent Skills
├── .github/             # CI/CD Workflows
├── app/                 # Main Application Package
│   ├── __init__.py
│   ├── main.py          # FastAPI Entry Point (was app.py)
│   ├── api/             # API Routers
│   │   ├── routes.py    # General Routes
│   │   └── bot.py       # Bot Framework Handler
│   ├── core/            # Configuration & Settings
│   │   └── config.py
│   ├── services/        # Business Logic
│   │   └── genie.py     # GenieService
│   └── models/          # Pydantic Models & Schemas
├── bot/                 # Bot Framework Specifics
│   ├── dialogs/         # ComponentDialogs
│   ├── cards/           # Adaptive Cards
│   └── handlers/        # ActivityHandlers
├── tests/               # Test Suite
│   ├── unit/            # Unit Tests
│   └── integration/     # Integration Tests
├── docs/                # Documentation
│   ├── api/             # API Specs
│   └── architecture/    # Design Docs
├── logs/                # Log files (gitignored)
├── .env                 # Secrets (gitignored)
├── .gitignore
└── requirements.txt
```
